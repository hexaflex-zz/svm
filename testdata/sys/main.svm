;
; The sys module performs some bootstrapping boilerplate so you don't have to.
; It does the following:
;
; * Loads all peripheral ids into globally accessible variables.
;   Ready for use in INT instructions.
;

import "fd35"
import "sprdi"
import "gp14"
import "clock"
import "as4"

; Bootstrap performs some boilerplate initialization.
; This is a macro to ensure it is embedded in the boot sector.
;
; exitHandler is an address this code jumps to if any of the required
; devices can not be found.
macro Bootstrap exitHandler
    hwa fd35.Device, $fd35.Manufacturer, $fd35.Serial                          ; Find the device index for the floppy disk drive.
    jez exitHandler

    hwa sprdi.Device, $sprdi.Manufacturer, $sprdi.Serial                       ; Find the device index for the display.
    jez exitHandler

    hwa gp14.Device, $gp14.Manufacturer, $gp14.Serial                          ; Find the device index for the gamepad.
    jez exitHandler

    hwa clock.Device, $clock.Manufacturer, $clock.Serial                       ; Find the device index for the clock.
    jez exitHandler

    hwa as4.Device, $as4.Manufacturer, $as4.Serial                             ; Find the device index for the audio synthesizer.
    jez exitHandler
endmacro